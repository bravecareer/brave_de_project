unit_tests:
  - name: test_incremental_updated_at_for_inventory
    description: "Test incremental logic for updated_at and ensure inventory records are updated correctly in dim_inventory_data_gs."
    model: dim_inventory_data_gs
    overrides:
      macros:
        is_incremental: True  # Force full refresh mode for the test
    given:
      # New incoming data from the transformed table
      - input: ref('inventory_data_transformed_gs')
        rows:
          - {INVENTORY_ID: 1, PRODUCT_ID: 'P001', WAREHOUSE_ID: 'W01', SUPPLIER_ID: 'S001', STORAGE_CONDITION: 'Cold', Inventory_status: 'In Stock', REORDER_LEVEL: 10, SAFETY_STOCK: 5, AVERAGE_MONTHLY_DEMAND: 50, RATING: 4.5, WEIGHT_KG: 2.5, DISCOUNT_PERCENTAGE: 10, SALES_VOLUME: 100, STOCK_STATUS: 'Available', RESTOCK_PRIORITY: 'Medium', UPDATED_AT: '2024-02-20 12:00:00'}
          - {INVENTORY_ID: 2, PRODUCT_ID: 'P002', WAREHOUSE_ID: 'W02', SUPPLIER_ID: 'S002', STORAGE_CONDITION: 'Ambient', Inventory_status: 'Low Stock', REORDER_LEVEL: 5, SAFETY_STOCK: 2, AVERAGE_MONTHLY_DEMAND: 20, RATING: 3.8, WEIGHT_KG: 1.2, DISCOUNT_PERCENTAGE: 5, SALES_VOLUME: 30, STOCK_STATUS: 'Low', RESTOCK_PRIORITY: 'High', UPDATED_AT: '2024-02-21 14:30:00'}
      
      # Current state of the `dim_inventory_data_gs` table before the incremental run
      - input: this  
        rows:
          - {INVENTORY_ID: 1, PRODUCT_ID: 'P001', WAREHOUSE_ID: 'W01', SUPPLIER_ID: 'S001', STORAGE_CONDITION: 'Cold', Inventory_status: 'In Stock', REORDER_LEVEL: 10, SAFETY_STOCK: 5, AVERAGE_MONTHLY_DEMAND: 50, RATING: 4.5, WEIGHT_KG: 2.5, DISCOUNT_PERCENTAGE: 10, SALES_VOLUME: 100, STOCK_STATUS: 'Available', RESTOCK_PRIORITY: 'Medium', UPDATED_AT: '2024-02-18 10:00:00'}
    
    expect:
      rows:
        # Inventory 1: Updated record (new `updated_at` timestamp)
        - {INVENTORY_ID: 1, PRODUCT_ID: 'P001', WAREHOUSE_ID: 'W01', SUPPLIER_ID: 'S001', STORAGE_CONDITION: 'Cold', Inventory_status: 'In Stock', REORDER_LEVEL: 10, SAFETY_STOCK: 5, AVERAGE_MONTHLY_DEMAND: 50, RATING: 4.5, WEIGHT_KG: 2.5, DISCOUNT_PERCENTAGE: 10, SALES_VOLUME: 100, STOCK_STATUS: 'Available', RESTOCK_PRIORITY: 'Medium', UPDATED_AT: '2024-02-20 12:00:00'}
        
        # Inventory 2: New record should be inserted
        - {INVENTORY_ID: 2, PRODUCT_ID: 'P002', WAREHOUSE_ID: 'W02', SUPPLIER_ID: 'S002', STORAGE_CONDITION: 'Ambient', Inventory_status: 'Low Stock', REORDER_LEVEL: 5, SAFETY_STOCK: 2, AVERAGE_MONTHLY_DEMAND: 20, RATING: 3.8, WEIGHT_KG: 1.2, DISCOUNT_PERCENTAGE: 5, SALES_VOLUME: 30, STOCK_STATUS: 'Low', RESTOCK_PRIORITY: 'High', UPDATED_AT: '2024-02-21 14:30:00'}
