version: 2

unit_tests:
  - name: test_search_effectiveness_non_incremental
    model: fact_product_search_effectiveness_gs 
    given:
      - input: ref('view_user_journey_transformed_gs')
        rows:
          - { search_event_id: "s1", product_id: "p1", has_atc: true }
          - { search_event_id: "s2", product_id: "p1", has_atc: false }
          - { search_event_id: "s3", product_id: "p2", has_atc: true }
      - input: ref('dim_product_data_gs')
        rows:
          - { product_id: "p1", product_name: "Product A" }
          - { product_id: "p2", product_name: "Product B" }
    expect:
      rows:
        - { product_id: "p1", product_name: "Product A", total_searches: 2, total_atc_events: 1, atc_rate: 0.5 }
        - { product_id: "p2", product_name: "Product B", total_searches: 1, total_atc_events: 1, atc_rate: 1.0 }
